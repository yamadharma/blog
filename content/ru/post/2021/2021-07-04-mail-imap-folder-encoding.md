---
title: "Почта. Кодировка папок IMAP"
author: ["Dmitry S. Kulyabov"]
date: 2021-07-04T20:43:00+03:00
lastmod: 2024-03-24T16:51:00+03:00
tags: ["network", "sysadmin"]
categories: ["computer-science"]
draft: false
slug: "mail-imap-folder-encoding"
---

Национальные символы в именах почтовых ящиков на сервере должны кодироваться в модифицированную кодировку UTF-7.

<!--more-->

{{< toc >}}


## <span class="section-num">1</span> Общая информация {#общая-информация}

-   В соответствие с RFC2060 национальные символы в именах почтовых ящиков на сервере должны кодироваться в модифицированную кодировку UTF-7.
-   Отличия от оригинальной UTF-7 связаны с особым значением символа `+` в некоторых почтовых системах и символа `/` в роли разделителя имён каталогов в Unix.


## <span class="section-num">2</span> Преобразование {#преобразование}


### <span class="section-num">2.1</span> Кодирование {#кодирование}

-   Алгоритм кодирования имён папок:
    -   Текст -&gt; UTF7;
    -   `&` -&gt; `&-`;
    -   `/` -&gt; `,`;
    -   `+` -&gt; `&`.
-   Код (shell):
    ```shell
    echo "Черновики" |  iconv -f UTF8 -t UTF7 | sed 's/&/&-/g;s/\//,/g;s/+/\&/g'
    ```
-   В результате получаем:
    ```shell
    &BCcENQRABD0EPgQyBDgEOgQ4
    ```


### <span class="section-num">2.2</span> Декодирование {#декодирование}

-   Алгоритм декодирования имён папок:
    -   `&` -&gt; `+`;
    -   `&-` -&gt; `&`;
    -   `,` -&gt; `/`;
    -   UTF7 -&gt; Текст.
-   Код (shell):
    ```shell
    echo '&BB4EQgQ,BEAEMAQyBDsENQQ9BD0ESwQ1-' | sed 's/&\([^-]\)/+\1/g;s/&-/&/g;s/,/\//g' | iconv -f UTF7 -t UTF8
    ```
-   В результате получаем:
    ```shell
    Отправленные
    ```
