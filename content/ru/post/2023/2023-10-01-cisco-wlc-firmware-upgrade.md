---
title: "Контроллер Cisco WLC. Обновление программного обеспечения"
author: ["Dmitry S. Kulyabov"]
date: 2023-10-01T19:37:00+03:00
lastmod: 2023-10-02T19:48:00+03:00
tags: ["network", "sysadmin", "cisco"]
categories: ["computer-science"]
draft: false
slug: "cisco-wlc-firmware-upgrade"
---

Контроллер Cisco WLC. Обновление программного обеспечения.

<!--more-->

{{< toc >}}


## <span class="section-num">1</span> Общая информация {#общая-информация}

-   Не отключайте контроллер или любую точку доступа в процессе обновления.
-   В противном случае можно повредить образ программного обеспечения.
-   Обновление контроллера с большим числом точек доступа может занять около 30 минут в зависимости от размера сети.
-   В это время точки доступа должны оставаться подключёнными к сети питания и не должен выполняться сброс контроллера.
-   Программное обеспечение контроллера представляет собой файл размером порядка 100 мегабайт с именем формата `AIR-CTYYYY-K9-X-X-XX.aes`.


## <span class="section-num">2</span> Процедура обновления из интерфейса командной строки {#процедура-обновления-из-интерфейса-командной-строки}


### <span class="section-num">2.1</span> Подготовка {#подготовка}

-   Убедитесь в доступности TFTP-сервера из контроллера и в нахождении файла обновления в корневом каталоге TFTP-сервера.
-   Лучше всего выполнять данную процедуру через порт консоли, но можно также использовать протокол SSH или Telnet для подключения к IP-адресу управления контроллера.
-   Использование протокола SSH или Telnet приводит к потере соединения с контроллером во время процесса перезагрузки, выполняемого после загрузки образа.
-   Проверьте текущую версию программного обеспечения, используемого в контроллере:
    ```shell
    show sysinfo
    ```


### <span class="section-num">2.2</span> Задание параметров загрузки образа {#задание-параметров-загрузки-образа}

-   Задайте режим передачи файлов:
    ```shell
    transfer download mode tftp
    ```
-   Задайте IP-адрес TFTP-сервера:
    ```shell
    transfer download serverip <IP-адрес TFTP-сервера>
    ```
-   Задайте путь к каталогу на TFTP-сервере, в котором находится программное обеспечение операционной системы контроллера:
    ```shell
    transfer download path '<путь TFTP-сервера>'
    ```
-   Задать имя файла образа:
    ```shell
    transfer download filename <имя файла>
    ```


### <span class="section-num">2.3</span> Скачивание образа {#скачивание-образа}

-   Инициировать процесс обновления:
    ```shell
    transfer download start
    ```


### <span class="section-num">2.4</span> Предварительная загрузка образа обновления Cisco WLC на точки доступа {#предварительная-загрузка-образа-обновления-cisco-wlc-на-точки-доступа}

-   Необязательно.
-   Предварительная загрузка нового образ на точки доступа для сокращения времени простоя:
    ```shell
    config ap image predownload primary all
    ```

    -   Эта команда сообщает контроллеру загрузить образ на все ваши точки доступа.
    -   Этот процесс занимает несколько минут на каждой точке доступа.
-   Отслеживание прогресса:
    ```shell
    show ap image all
    ```
-   Указать точкам доступа, чтобы они установили этот образ в качестве основного образа для использования при следующей перезагрузке:
    ```shell
    config ap image swap all
    ```
-   Убедитесь, что новое изображение теперь установлено в качестве основного:
    ```shell
    show ap image all
    ```


### <span class="section-num">2.5</span> Перезагрузка {#перезагрузка}

-   После завершения обновления перезагрузите контроллер, чтобы новое программное обеспечение вступило в силу:
    ```shell
    reset system in HH:MM:SS image no-swap reset-aps save-config
    ```

    -   `image no-swap` сообщает контроллерам и точкам доступа о необходимости перезагрузки с использованием текущего образа, установленного в качестве основного, который является новым образом.
    -   `reset-aps` указывает точкам доступа перезагрузиться одновременно с контроллерами, а не ждать, пока контроллеры вернутся и поймут, что им необходимо перезагрузить. Это сократит время простоя.
    -   `save-config` указывает контроллерам сохранить текущую конфигурацию в загрузочную конфигурацию перед перезагрузкой, гарантируя, что все ожидающие изменения будут записаны до перезагрузки.


### <span class="section-num">2.6</span> Выбор образа для загрузки {#выбор-образа-для-загрузки}

-   По умолчанию на контроллере WLC поддерживаются два образа: основной и резервный образы.
-   Основной образ --- это активный образ, используемый контроллером WLC.
-   Резервный образ используется в качестве резервной копии активного образа.
-   При обновлении контроллера WLC с помощью нового образа контроллер WLC автоматически копирует новый образ поверх резервного образа.
-   Просмотреть сведения об активном образе, используемом контроллером в данный момент (основной образ):
    ```shell
    show boot
    ```
-   Выбрать какой образ будет активным (используемым контроллером WLC при загрузке):
    ```shell
    config boot <primary/backup>
    ```
-   Чтобы контроллер WLC использовал новый активный образ, необходимо сохранить и перезагрузить его конфигурацию.


## <span class="section-num">3</span> Проблемы {#проблемы}


### <span class="section-num">3.1</span> Cisco Aironet 1700 {#cisco-aironet-1700}

-   Меняли прошивку WLC c 8.0.115 на 8.3.150.
-   После обновления точки доступа не скачивали образ.
-   Писали, что не поддерживают и прочую ерунду.
-   Нашли в сети следующее:

    > Disable Network Time Protocol (NTP) on the WLC and manually set the WLC date/time to a date before December 2, 2022. The Cisco IOS AP will then be able to download and validate the image, install the new image, and join the controller. Once the AP has joined the controller, NTP can be re-enabled on the controller to assume the correct date and time.
-   Отключили NTP.
-   Откатили даты назад.
-   Точки доступа стали загружать образ.
